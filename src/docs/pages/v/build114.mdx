# 114.b6
环境准备
------
   * `apt install python3-distutils libasound2-dev libpulse-dev libxkbcommon-x11-dev libpango1.0-dev libx11-xcb-dev  libxrandr-dev  libgtk-3-dev libdbus-glib-1-dev`
   * `cargo install cbindgen`
   * 如果需要运行测试。则还需要https://github.com/mozilla/fix-stacks
       *  安装后需要在`tools/rb/fix-stacks.py`内手动指定路径，否则会找不到

Config
------
* mozconfig
```text-plain
ac_add_options --enable-application=comm/mail
ac_add_options --disable-crashreporter
ac_add_options --without-wasm-sandboxed-libraries
ac_add_options --enable-official-branding
ac_add_options --enable-optimize
#ac_add_options --enable-linker=mold
#export BUILD_OFFICIAL=1
#export MOZILLA_OFFICIAL=1	
#export MOZ_UPDATE_CHANNEL=release
#mk_add_options BUILD_OFFICIAL=1
#mk_add_options MOZ_CO_PROJECT=mail
#mk_add_options MOZILLA_OFFICIAL=1
```

PATCH
-----
###  D178494
* D178494.diff
```diff
diff --git a/js/xpconnect/src/XPCJSContext.cpp b/js/xpconnect/src/XPCJSContext.cpp
--- a/js/xpconnect/src/XPCJSContext.cpp
+++ b/js/xpconnect/src/XPCJSContext.cpp
@@ -950,11 +950,11 @@
       cx, JSJITCOMPILER_FULL_DEBUG_CHECKS,
       StaticPrefs::javascript_options_jit_full_debug_checks_DoNotUseDirectly());
 #endif
 
 #if !defined(JS_CODEGEN_MIPS32) && !defined(JS_CODEGEN_MIPS64) && \
-    !defined(JS_CODEGEN_RISCV64)
+    !defined(JS_CODEGEN_RISCV64) && !defined(JS_CODEGEN_LOONG64)
   JS_SetGlobalJitCompilerOption(
       cx, JSJITCOMPILER_SPECTRE_INDEX_MASKING,
       StaticPrefs::javascript_options_spectre_index_masking_DoNotUseDirectly());
   JS_SetGlobalJitCompilerOption(
       cx, JSJITCOMPILER_SPECTRE_OBJECT_MITIGATIONS,
diff --git a/modules/libpref/init/StaticPrefList.yaml b/modules/libpref/init/StaticPrefList.yaml
--- a/modules/libpref/init/StaticPrefList.yaml
+++ b/modules/libpref/init/StaticPrefList.yaml
@@ -7789,14 +7789,14 @@
   type: bool
   value: true
   mirror: always  # LoadStartupJSPrefs
   do_not_use_directly: true
 
-#if !defined(JS_CODEGEN_MIPS32) && !defined(JS_CODEGEN_MIPS64)
+#if !defined(JS_CODEGEN_MIPS32) && !defined(JS_CODEGEN_MIPS64) && !defined(JS_CODEGEN_LOONG64)
   # Spectre security vulnerability mitigations for the JS JITs.
   #
-  # NOTE: The MIPS backends do not support these mitigations (and generally
+  # NOTE: The MIPS and LoongArch backends do not support these mitigations (and generally
   #       do not need them). In that case, leave the pref unlisted with its
   #       default value of false.
 -   name: javascript.options.spectre.index_masking
     type: bool
     value: true
@@ -7824,11 +7824,11 @@
 -   name: javascript.options.spectre.jit_to_cxx_calls
     type: bool
     value: true
     mirror: always  # LoadStartupJSPrefs
     do_not_use_directly: true
-#endif  // !defined(JS_CODEGEN_MIPSXX)
+#endif  // !defined(JS_CODEGEN_MIPSXX) && !defined(JS_CODEGEN_LOONG64)
 
 # Separate pref to override the values of the Spectre-related prefs above for
 # isolated web content processes, where we don't need these mitigations.
 - name: javascript.options.spectre.disable_for_isolated_content
   type: bool
```
```sh 
patch -p1 -d thunderbird-114.0 < D178494.diff
```

###  js/xpconnect/src/xpcpublic.h

```diff
--- a/js/xpconnect/src/xpcpublic.h      2023-06-07 22:21:05.612276560 +0800
+++ b/js/xpconnect/src/xpcpublic.h      2023-06-07 22:23:01.019119027 +0800
@@ -706,6 +706,8 @@
 // We need an exact page size only if we run the binary in automation.
 #if defined(XP_DARWIN) && defined(__aarch64__)
 const size_t kAutomationPageSize = 16384;
+#elif defined(XP_LINUX) && defined(__loongarch64)
+const size_t kAutomationPageSize = 16384;
 #else
 const size_t kAutomationPageSize = 4096;
 #endif
```

### comm/third\_party/botan

```sh
#cd到代码树的上一层
https://github.com/randombit/botan/commit/7bc8a874f613630d20a90d742cffef1466ba1147.patch  -O  botan-7bc8a.patch
patch -p1 -d thunderbird-114.0/comm/third_party/botan/ < botan-7bc8a.patch
```

### ipc/chromium/src/build/build\_config.h

*   这个文件将会在116版本被移除，see [THIS](https://bugzilla.mozilla.org/show_bug.cgi?id=1835185)
*   ipc-chromium.patch
```diff 
--- a/ipc/chromium/src/build/build_config.h
+++ b/ipc/chromium/src/build/build_config.h
@@ -97,6 +97,9 @@
 #elif defined(__mips64) && defined(__LP64__)
 #  define ARCH_CPU_MIPS 1
 #  define ARCH_CPU_64_BITS 1
+#elif defined(__loongarch64)
+#  define ARCH_CPU_LOONGARCH 1
+#  define ARCH_CPU_64_BITS 1
 #elif defined(__mips__)
 #  define ARCH_CPU_MIPS 1
 #  define ARCH_CPU_32_BITS 1
```
```sh 
patch -p1 -d thunderbird-114.0 < ipc-chromium.patch
```

### third\_party/rust/nix
*  nix.patch
```diff
--- a/third_party/rust/nix/.cargo-checksum.json	2023-06-01 09:14:39.000000000 +0800
+++ b/third_party/rust/nix/.cargo-checksum.json	2023-06-05 01:23:59.000000000 +0800
@@ -1 +1 @@
-{"files":{"CHANGELOG.md":"8ee4e556e53d1b39400a48675d3ecff0bf27e419accab7ca3be76ab934289548","Cargo.toml":"2e6eff9170182f107188b8bc9802efd044ef47178afc7f138950ecff1c1ceb96","LICENSE":"66e3ee1fa7f909ad3c612d556f2a0cdabcd809ad6e66f3b0605015ac64841b70","README.md":"1ed9a0e26ae6e575b3262ae734dd02889455593b761ee62403ea5a64104f3c9c","src/dir.rs":"0280a2dc480bd913f24ed84fbe26569fa2e8eefa660e5ad7c21e05fc34c14d16","src/env.rs":"028bc5e20139ebba418a655a2978a53335dc7680bf1de43d2c8333dd72cfa5c4","src/errno.rs":"e55d075858e349d9afea9ce0480f7fb7ba4dccccf0694fd7b3280b918836203c","src/fcntl.rs":"ea8f43d8fec0b6c3b7d903333e4c1ce85611684a4afd561c55cfe4b61a979e94","src/features.rs":"5b4a0831e5f4b79a6f0e42ed052fd66c875da18959750be51e41fb59ac19feed","src/ifaddrs.rs":"377865eb48040d28c392a1aec0221320108e3392ea285d23405ae2cfa5c54b20","src/kmod.rs":"c818ced08d55ae36fdf82fa914ba856b688e37234d574d3faa37128211d512fb","src/lib.rs":"a62fac2ba7111157c5b64251f67f8a189f04bd587d5c80703454a596ea7ae5d9","src/macros.rs":"e23d7d8be22ef0bf9febaaf2739585453103607c0139bd3995a324e4a16d011e","src/mount/bsd.rs":"4cf35606a63d7ca41caac3b38f01e2b70c63e71978c0529f19fc79182629dbe0","src/mount/linux.rs":"6e5d61788dedf1ca4416c6c6a3a9c6c747f9352c26d863f4a1d4142e288584d6","src/mount/mod.rs":"ba9f60eb831224ab73bdd87e00e15d13b9ce9efb70b18bf8f3fe60406d522b3e","src/mqueue.rs":"ed0a189036b2437b5f7f7f1312fa545540b06ca72171b451d8bce42cc3627534","src/net/if_.rs":"b32a8a1f952de60d95e549779a5c673fd72aa665e86bfdfc8ec6badf3016b9b1","src/net/mod.rs":"577f70170e53d4a6de1abb70bf8f1031ec3e65c0e63ef5fcf05c907125e7ac17","src/poll.rs":"2fc1d144fb40db51811c6357b520ab7993529702d8f0d8060c903118ff4f7259","src/pty.rs":"27b4f76c23acf02542674017067fee74cdcac907338458700a1aa4d6f6a62e27","src/sched.rs":"403aa5ebed81910263d42a94717612b737550bf053227b7d90f1c8949188d919","src/sys/aio.rs":"ae091de8540c97da374a39e7d154c1b3ce50f41e6fc20a45c6b06eb838e74366","src/sys/epoll.rs":"28e22debf474d1b047e8044a00b354c25dab2fa125960f9f2f14cc34289fd5c9","src/sys/event.rs":"dbd8e84bccb813839295b0a336485783ef19548d2317931f0ceb5ee62f839a40","src/sys/eventfd.rs":"c8db8f5874726fdad289ad5e2603a7d71a1ae5a899dcde3a35d3edff8b498b7e","src/sys/inotify.rs":"5b4da774313afa9c28c3f92f9d07dce9bf4c8d044fd6a16f19480e79a19e808b","src/sys/ioctl/bsd.rs":"bbd02e30b0a78c1cb22777d9b00cfcbba9c68505cffc06118ac68474cf6fea39","src/sys/ioctl/linux.rs":"028181834d119b834bf399f2b8a6176cc57e75144693f28f32059d087d8c8018","src/sys/ioctl/mod.rs":"89b20579476b2e0254e0ecb1b41830cccd7027a22cbdb816a9d4ec3924842ac1","src/sys/memfd.rs":"f58d7fbe67c4b994832d72f5fbd59c136c8f1ae88ea8b0bc1c099db2d847ee6c","src/sys/mman.rs":"17df1bc34ba92bdd6bad1e11e4ef139998117f6c468c8f560421858f3cc899a5","src/sys/mod.rs":"baabf649f758ad4acce849ec1795dd4e4f9c6539e677bad5fa777300a4871dcb","src/sys/personality.rs":"aa89760c023bfec3fca5d8636f9eac9d337f5547933793ce6df7a0de97ae6ee1","src/sys/pthread.rs":"258cdf7ff0b61a4afa6d228109e4cb4fb88d859bb8dfe6c959d95130fb010906","src/sys/ptrace/bsd.rs":"4c590d8f023ff52f396f8b6f2150c08e5c9486d3088d9c173db33a70d616b800","src/sys/ptrace/linux.rs":"c82db3fb18aa97755f9ccb440a957cd46d664968a94045830c5d74d2d53bc19f","src/sys/ptrace/mod.rs":"e9e5d970097f5eafffba900959d4fdbf233bff9ed7f599fc9896bb44d86a57a4","src/sys/quota.rs":"02e698a25f0986fb43aa88689f3d3d8b9edc6ae48496ad02f7214fccaa493e00","src/sys/reboot.rs":"eacdf57694a6629fb05787e16450446102a62818274495f2ad4e445807d09221","src/sys/resource.rs":"d498d0c00fd30e35e1269a8902cb812014d813f63ec95364f8f59f1912ba5657","src/sys/select.rs":"65c39b129d3cc85b8ca026ff26dcf80c5639824f43715881c3c1bbb6bf0c8a60","src/sys/sendfile.rs":"7a62099f9771fecff49b9c11210341e3c1a4acf22f8dfb96d395e29421648676","src/sys/signal.rs":"c3e13a2edea54d190a4b051f62efc97953c00b5051a9fda0e39e3bc732a31939","src/sys/signalfd.rs":"583524434fd37143be3db37fa6f6cbd339f7946416f05b58a95e246947e5cc9d","src/sys/socket/addr.rs":"84df895052f59ec84774b189ffb285d2a37a9703af6c8310ae5040cca1a2583e","src/sys/socket/mod.rs":"6deb55438cad3606385303f036b0efd842dfd759fba93611911f5a4f2613c9dc","src/sys/socket/sockopt.rs":"ed1f920364bfe88bbe6eaeeefb27a63bfcdd7d67604aca2f03e22f2b502df55a","src/sys/stat.rs":"337dea8d55d6177dc85b3235b40b8a3e81af7f4a6e2806a0b2f730bec5424350","src/sys/statfs.rs":"17103659a85279bac046c69cb3b22bf2c11c2492cffb0edfa4c3b233d161a2f2","src/sys/statvfs.rs":"f81e3900ef90d62e7eceaf1b6ff8dcfd965466714c033eb4717687f692171f48","src/sys/sysinfo.rs":"b4519b1ca091c9dbe94d2a6fd6304944bf3df5626973d2c6884022559706f0d9","src/sys/termios.rs":"7923f9846a8122096b6b1cd240d3618b876ce500a751ac434954d172e2e85745","src/sys/time.rs":"9026033b60a5ccc95b70424aef043c8c748722e2ea8c7c86366ecd4585b651a0","src/sys/timer.rs":"8c10f0e7cfac857ad00460be30bc68b957909cc9296e70718d3b5d4a0babafde","src/sys/timerfd.rs":"ef7c48aefdcfac13316eeddbef5da04cf12e9f574b8d9f43402c02b6b8db86b3","src/sys/uio.rs":"e1d59ccbee9d46c65d3aa8c36aa3a3222539beea0d20163a8b707d08fca14e09","src/sys/utsname.rs":"0cdda0cc111caaa0e4ebe2d4588bdc825d878e5bcb7a9136073b15f87a20e11f","src/sys/wait.rs":"cc70d2d9b880ff6c48577a479c209af6127067bc013a90ee22538e4dfad7d2b4","src/time.rs":"d4e0872361a57810837f5bd790cbca3a2b9db1ac4694a3c52d1564ad3532d3be","src/ucontext.rs":"b8f2e04757a9c2bc38c3b1e259d3a013da8a730fe9bfbe5487637395681b43d3","src/unistd.rs":"e19be456124731c5b93aef92ed72a7c4c9092e28db0649814ba3fcc1f0d620fa","test/common/mod.rs":"1d7e28e3635754664cd056f3a1079232ff5c118df619e1d0551a9972eb0b3cd6","test/sys/mod.rs":"87b2891d83067ff21f72b8ff7fde3019dc45b6877282ac278b6da151de45c7a7","test/sys/test_aio.rs":"4dac9f716f852f1f438f78d6e64bf041e6fd316bf15dcb27afffaf0894bdefa6","test/sys/test_aio_drop.rs":"614070155fa16a979b7341d001639c5ce24a1d6f632c3abce45a5a6d49c4039b","test/sys/test_epoll.rs":"ffe95e36c79e37426ef8e8ca3b137b7f35ea0333ce666a20a4b7878db17680e9","test/sys/test_inotify.rs":"a141b9a995892547b51ceeb6761a70a6b86d37e8f38d13ea2c497b81b4b0f49f","test/sys/test_ioctl.rs":"00ccc5afb665e533a0a4b6d6a6be438bcaea19fce335390feef4e91d17b3036c","test/sys/test_mman.rs":"2b4161964c9204b74659028b0f89a88f4e3bcc9886137a3039737cd91d2698cb","test/sys/test_pthread.rs":"ace36a2f5587f1874854281b4fd84e4e4d892a1e3c5cc38ced57975739522ad6","test/sys/test_ptrace.rs":"0385eebc8b1b8c72f655b745769decd9143ad83018198375982da0896310456b","test/sys/test_select.rs":"54cea1c34ad28d5770a613c1c3cbc3b1064b22037ec2b9d3fcd422d3be9e60a7","test/sys/test_signal.rs":"acc9941227bd3e2afad323613c2b8c83902ed0486d3745fd72704f395924f1e4","test/sys/test_signalfd.rs":"0e1060143e2612c490bc3d0168d0bbb042ef55e3f1d91d2578b9e42e4310a14d","test/sys/test_socket.rs":"d2df1001f9a0b2dac0b88051a67c3868bb216e72e4da4eecd11c4448b9fa4b40","test/sys/test_sockopt.rs":"4465f22f718442f3f7b502e052dad02b93cebfa3b71fa55ff4f25fb02534acab","test/sys/test_stat.rs":"6630a28217fd708bb84cd4f7e7101836b74f2420f9888923fdab664ccc331c1d","test/sys/test_sysinfo.rs":"ffd49bc96375914a2c4a4a59730cae8072f85771e2c4a80d3403df38d967e272","test/sys/test_termios.rs":"e5bcef10c84bd7583d600d5601835bcb3cfc88781cb283ab0185bbef5faf4327","test/sys/test_timerfd.rs":"cfed3abf58118611d08f6985251a7739cff67108e11214222a1d2394a3a026ce","test/sys/test_uio.rs":"32656bd0a5699e4d019aa928edf104637937179782914a82d50d37226e84c421","test/sys/test_wait.rs":"6fd59fffeeb09ff620c359baefd062ba777598982b6cb001ccc07b6bc7605493","test/test.rs":"11f40b0718ddd1a150cb9e703d56d0b2a9462306505a2245ddf273a2011f48b5","test/test_clearenv.rs":"45ca548035b3c20ec87314715feaba2be973709a635d85b8cde46fd1d9f1ecd4","test/test_dir.rs":"ae3c11c58cb06da6557aa2a839c6653c54cd7724283fffe9df5a5d3feabdd89a","test/test_fcntl.rs":"71dcb87f7b04d78fc62937ba46cb7f0f1f2dbb330b63a996ea2e8ec9056b98a9","test/test_kmod/hello_mod/Makefile":"0219f7bce0603f97d997fb377ca071966c90333ecc665e78a54dfeb97a9c811b","test/test_kmod/hello_mod/hello.c":"bcac6b19c5bd807e1f3878c15e426acc85785a8ade9840c3bb4d068635c9188c","test/test_kmod/mod.rs":"b4ae25841c2f06f32de9f1acd8230eeccd7095721302ebe78ad454e4e4f9c783","test/test_mount.rs":"6dd242b6e23c9c39e1a75612bbea62573898818ab374c3c032c2cdb97033554d","test/test_mq.rs":"136071f24131aac0e65d5f29ac18e3806641dfae1164813f5570c0e3a6f70553","test/test_net.rs":"f2912327ebb2a3d37e6cff02a5ac3106cf889cc5c74404db4ef0034059ba26f1","test/test_nix_path.rs":"01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b","test/test_nmount.rs":"d6c112547bb80968170b5497cda4b6cbf69dabec6f51d494bd52298995ceff18","test/test_poll.rs":"3e0b8f0397ba080785c61a3bfc3d637bc87f324bc4e52b5f1bf3ca0d32dbc9fe","test/test_pty.rs":"b26238a0783746cb31880e11eebc1913149be999ce75fbc2d6677bdd1e2731b2","test/test_ptymaster_drop.rs":"ae63c815f5028ddc67d194e86559483018ab1816316bdb917f40cee9364fd8a5","test/test_resource.rs":"40aef790ab745cec31a4b333d2ca406b462aa9bdf4a6d3756371e498b8d51e9a","test/test_sched.rs":"c4579bd376fab8816e63b07fa9ace31dc08e63ebb7c855a2c450698090d1d1e8","test/test_sendfile.rs":"bb41b4f3621b518e397d3a5b5ad3c5dcef3fe506afe516eab7572fbab92b77e3","test/test_stat.rs":"c407ca47a5258750076d041afad2f6add4c3563be36628bde1c5b314f5d0765d","test/test_time.rs":"f7a21b1e279e60e84909d5dadda97ded66d3326b131fe317badf9af0a1b50335","test/test_timer.rs":"3ae20d364f075d2811f3ff94eda9886682cc21d8807656007d2464fe36d1e361","test/test_unistd.rs":"20a00be4fbe26302ea5fe50ce25b99265dc763db138663d6aa1d7ac729a1d292"},"package":"bfdda3d196821d6af13126e40375cdf7da646a96114af134d5f417a9a1dc8e1a"}
\ 文件尾没有换行符
+{"files":{"CHANGELOG.md":"8ee4e556e53d1b39400a48675d3ecff0bf27e419accab7ca3be76ab934289548","Cargo.toml":"2e6eff9170182f107188b8bc9802efd044ef47178afc7f138950ecff1c1ceb96","LICENSE":"66e3ee1fa7f909ad3c612d556f2a0cdabcd809ad6e66f3b0605015ac64841b70","README.md":"1ed9a0e26ae6e575b3262ae734dd02889455593b761ee62403ea5a64104f3c9c","src/dir.rs":"0280a2dc480bd913f24ed84fbe26569fa2e8eefa660e5ad7c21e05fc34c14d16","src/env.rs":"028bc5e20139ebba418a655a2978a53335dc7680bf1de43d2c8333dd72cfa5c4","src/errno.rs":"e55d075858e349d9afea9ce0480f7fb7ba4dccccf0694fd7b3280b918836203c","src/fcntl.rs":"ea8f43d8fec0b6c3b7d903333e4c1ce85611684a4afd561c55cfe4b61a979e94","src/features.rs":"5b4a0831e5f4b79a6f0e42ed052fd66c875da18959750be51e41fb59ac19feed","src/ifaddrs.rs":"377865eb48040d28c392a1aec0221320108e3392ea285d23405ae2cfa5c54b20","src/kmod.rs":"c818ced08d55ae36fdf82fa914ba856b688e37234d574d3faa37128211d512fb","src/lib.rs":"a62fac2ba7111157c5b64251f67f8a189f04bd587d5c80703454a596ea7ae5d9","src/macros.rs":"e23d7d8be22ef0bf9febaaf2739585453103607c0139bd3995a324e4a16d011e","src/mount/bsd.rs":"4cf35606a63d7ca41caac3b38f01e2b70c63e71978c0529f19fc79182629dbe0","src/mount/linux.rs":"6e5d61788dedf1ca4416c6c6a3a9c6c747f9352c26d863f4a1d4142e288584d6","src/mount/mod.rs":"ba9f60eb831224ab73bdd87e00e15d13b9ce9efb70b18bf8f3fe60406d522b3e","src/mqueue.rs":"ed0a189036b2437b5f7f7f1312fa545540b06ca72171b451d8bce42cc3627534","src/net/if_.rs":"b32a8a1f952de60d95e549779a5c673fd72aa665e86bfdfc8ec6badf3016b9b1","src/net/mod.rs":"577f70170e53d4a6de1abb70bf8f1031ec3e65c0e63ef5fcf05c907125e7ac17","src/poll.rs":"2fc1d144fb40db51811c6357b520ab7993529702d8f0d8060c903118ff4f7259","src/pty.rs":"27b4f76c23acf02542674017067fee74cdcac907338458700a1aa4d6f6a62e27","src/sched.rs":"403aa5ebed81910263d42a94717612b737550bf053227b7d90f1c8949188d919","src/sys/aio.rs":"ae091de8540c97da374a39e7d154c1b3ce50f41e6fc20a45c6b06eb838e74366","src/sys/epoll.rs":"28e22debf474d1b047e8044a00b354c25dab2fa125960f9f2f14cc34289fd5c9","src/sys/event.rs":"dbd8e84bccb813839295b0a336485783ef19548d2317931f0ceb5ee62f839a40","src/sys/eventfd.rs":"c8db8f5874726fdad289ad5e2603a7d71a1ae5a899dcde3a35d3edff8b498b7e","src/sys/inotify.rs":"5b4da774313afa9c28c3f92f9d07dce9bf4c8d044fd6a16f19480e79a19e808b","src/sys/ioctl/bsd.rs":"bbd02e30b0a78c1cb22777d9b00cfcbba9c68505cffc06118ac68474cf6fea39","src/sys/ioctl/linux.rs":"54bad026ee637b73b95dad8135b6db61cae855670fd9323e7bf21acaff0827f4","src/sys/ioctl/mod.rs":"89b20579476b2e0254e0ecb1b41830cccd7027a22cbdb816a9d4ec3924842ac1","src/sys/memfd.rs":"f58d7fbe67c4b994832d72f5fbd59c136c8f1ae88ea8b0bc1c099db2d847ee6c","src/sys/mman.rs":"17df1bc34ba92bdd6bad1e11e4ef139998117f6c468c8f560421858f3cc899a5","src/sys/mod.rs":"baabf649f758ad4acce849ec1795dd4e4f9c6539e677bad5fa777300a4871dcb","src/sys/personality.rs":"aa89760c023bfec3fca5d8636f9eac9d337f5547933793ce6df7a0de97ae6ee1","src/sys/pthread.rs":"258cdf7ff0b61a4afa6d228109e4cb4fb88d859bb8dfe6c959d95130fb010906","src/sys/ptrace/bsd.rs":"4c590d8f023ff52f396f8b6f2150c08e5c9486d3088d9c173db33a70d616b800","src/sys/ptrace/linux.rs":"c82db3fb18aa97755f9ccb440a957cd46d664968a94045830c5d74d2d53bc19f","src/sys/ptrace/mod.rs":"e9e5d970097f5eafffba900959d4fdbf233bff9ed7f599fc9896bb44d86a57a4","src/sys/quota.rs":"02e698a25f0986fb43aa88689f3d3d8b9edc6ae48496ad02f7214fccaa493e00","src/sys/reboot.rs":"eacdf57694a6629fb05787e16450446102a62818274495f2ad4e445807d09221","src/sys/resource.rs":"d498d0c00fd30e35e1269a8902cb812014d813f63ec95364f8f59f1912ba5657","src/sys/select.rs":"65c39b129d3cc85b8ca026ff26dcf80c5639824f43715881c3c1bbb6bf0c8a60","src/sys/sendfile.rs":"7a62099f9771fecff49b9c11210341e3c1a4acf22f8dfb96d395e29421648676","src/sys/signal.rs":"c3e13a2edea54d190a4b051f62efc97953c00b5051a9fda0e39e3bc732a31939","src/sys/signalfd.rs":"583524434fd37143be3db37fa6f6cbd339f7946416f05b58a95e246947e5cc9d","src/sys/socket/addr.rs":"84df895052f59ec84774b189ffb285d2a37a9703af6c8310ae5040cca1a2583e","src/sys/socket/mod.rs":"6deb55438cad3606385303f036b0efd842dfd759fba93611911f5a4f2613c9dc","src/sys/socket/sockopt.rs":"ed1f920364bfe88bbe6eaeeefb27a63bfcdd7d67604aca2f03e22f2b502df55a","src/sys/stat.rs":"337dea8d55d6177dc85b3235b40b8a3e81af7f4a6e2806a0b2f730bec5424350","src/sys/statfs.rs":"17103659a85279bac046c69cb3b22bf2c11c2492cffb0edfa4c3b233d161a2f2","src/sys/statvfs.rs":"f81e3900ef90d62e7eceaf1b6ff8dcfd965466714c033eb4717687f692171f48","src/sys/sysinfo.rs":"b4519b1ca091c9dbe94d2a6fd6304944bf3df5626973d2c6884022559706f0d9","src/sys/termios.rs":"7923f9846a8122096b6b1cd240d3618b876ce500a751ac434954d172e2e85745","src/sys/time.rs":"9026033b60a5ccc95b70424aef043c8c748722e2ea8c7c86366ecd4585b651a0","src/sys/timer.rs":"8c10f0e7cfac857ad00460be30bc68b957909cc9296e70718d3b5d4a0babafde","src/sys/timerfd.rs":"ef7c48aefdcfac13316eeddbef5da04cf12e9f574b8d9f43402c02b6b8db86b3","src/sys/uio.rs":"e1d59ccbee9d46c65d3aa8c36aa3a3222539beea0d20163a8b707d08fca14e09","src/sys/utsname.rs":"0cdda0cc111caaa0e4ebe2d4588bdc825d878e5bcb7a9136073b15f87a20e11f","src/sys/wait.rs":"cc70d2d9b880ff6c48577a479c209af6127067bc013a90ee22538e4dfad7d2b4","src/time.rs":"d4e0872361a57810837f5bd790cbca3a2b9db1ac4694a3c52d1564ad3532d3be","src/ucontext.rs":"b8f2e04757a9c2bc38c3b1e259d3a013da8a730fe9bfbe5487637395681b43d3","src/unistd.rs":"e19be456124731c5b93aef92ed72a7c4c9092e28db0649814ba3fcc1f0d620fa","test/common/mod.rs":"1d7e28e3635754664cd056f3a1079232ff5c118df619e1d0551a9972eb0b3cd6","test/sys/mod.rs":"87b2891d83067ff21f72b8ff7fde3019dc45b6877282ac278b6da151de45c7a7","test/sys/test_aio.rs":"4dac9f716f852f1f438f78d6e64bf041e6fd316bf15dcb27afffaf0894bdefa6","test/sys/test_aio_drop.rs":"614070155fa16a979b7341d001639c5ce24a1d6f632c3abce45a5a6d49c4039b","test/sys/test_epoll.rs":"ffe95e36c79e37426ef8e8ca3b137b7f35ea0333ce666a20a4b7878db17680e9","test/sys/test_inotify.rs":"a141b9a995892547b51ceeb6761a70a6b86d37e8f38d13ea2c497b81b4b0f49f","test/sys/test_ioctl.rs":"00ccc5afb665e533a0a4b6d6a6be438bcaea19fce335390feef4e91d17b3036c","test/sys/test_mman.rs":"2b4161964c9204b74659028b0f89a88f4e3bcc9886137a3039737cd91d2698cb","test/sys/test_pthread.rs":"ace36a2f5587f1874854281b4fd84e4e4d892a1e3c5cc38ced57975739522ad6","test/sys/test_ptrace.rs":"0385eebc8b1b8c72f655b745769decd9143ad83018198375982da0896310456b","test/sys/test_select.rs":"54cea1c34ad28d5770a613c1c3cbc3b1064b22037ec2b9d3fcd422d3be9e60a7","test/sys/test_signal.rs":"acc9941227bd3e2afad323613c2b8c83902ed0486d3745fd72704f395924f1e4","test/sys/test_signalfd.rs":"0e1060143e2612c490bc3d0168d0bbb042ef55e3f1d91d2578b9e42e4310a14d","test/sys/test_socket.rs":"d2df1001f9a0b2dac0b88051a67c3868bb216e72e4da4eecd11c4448b9fa4b40","test/sys/test_sockopt.rs":"4465f22f718442f3f7b502e052dad02b93cebfa3b71fa55ff4f25fb02534acab","test/sys/test_stat.rs":"6630a28217fd708bb84cd4f7e7101836b74f2420f9888923fdab664ccc331c1d","test/sys/test_sysinfo.rs":"ffd49bc96375914a2c4a4a59730cae8072f85771e2c4a80d3403df38d967e272","test/sys/test_termios.rs":"e5bcef10c84bd7583d600d5601835bcb3cfc88781cb283ab0185bbef5faf4327","test/sys/test_timerfd.rs":"cfed3abf58118611d08f6985251a7739cff67108e11214222a1d2394a3a026ce","test/sys/test_uio.rs":"32656bd0a5699e4d019aa928edf104637937179782914a82d50d37226e84c421","test/sys/test_wait.rs":"6fd59fffeeb09ff620c359baefd062ba777598982b6cb001ccc07b6bc7605493","test/test.rs":"11f40b0718ddd1a150cb9e703d56d0b2a9462306505a2245ddf273a2011f48b5","test/test_clearenv.rs":"45ca548035b3c20ec87314715feaba2be973709a635d85b8cde46fd1d9f1ecd4","test/test_dir.rs":"ae3c11c58cb06da6557aa2a839c6653c54cd7724283fffe9df5a5d3feabdd89a","test/test_fcntl.rs":"71dcb87f7b04d78fc62937ba46cb7f0f1f2dbb330b63a996ea2e8ec9056b98a9","test/test_kmod/hello_mod/Makefile":"0219f7bce0603f97d997fb377ca071966c90333ecc665e78a54dfeb97a9c811b","test/test_kmod/hello_mod/hello.c":"bcac6b19c5bd807e1f3878c15e426acc85785a8ade9840c3bb4d068635c9188c","test/test_kmod/mod.rs":"b4ae25841c2f06f32de9f1acd8230eeccd7095721302ebe78ad454e4e4f9c783","test/test_mount.rs":"6dd242b6e23c9c39e1a75612bbea62573898818ab374c3c032c2cdb97033554d","test/test_mq.rs":"136071f24131aac0e65d5f29ac18e3806641dfae1164813f5570c0e3a6f70553","test/test_net.rs":"f2912327ebb2a3d37e6cff02a5ac3106cf889cc5c74404db4ef0034059ba26f1","test/test_nix_path.rs":"01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b","test/test_nmount.rs":"d6c112547bb80968170b5497cda4b6cbf69dabec6f51d494bd52298995ceff18","test/test_poll.rs":"3e0b8f0397ba080785c61a3bfc3d637bc87f324bc4e52b5f1bf3ca0d32dbc9fe","test/test_pty.rs":"b26238a0783746cb31880e11eebc1913149be999ce75fbc2d6677bdd1e2731b2","test/test_ptymaster_drop.rs":"ae63c815f5028ddc67d194e86559483018ab1816316bdb917f40cee9364fd8a5","test/test_resource.rs":"40aef790ab745cec31a4b333d2ca406b462aa9bdf4a6d3756371e498b8d51e9a","test/test_sched.rs":"c4579bd376fab8816e63b07fa9ace31dc08e63ebb7c855a2c450698090d1d1e8","test/test_sendfile.rs":"bb41b4f3621b518e397d3a5b5ad3c5dcef3fe506afe516eab7572fbab92b77e3","test/test_stat.rs":"c407ca47a5258750076d041afad2f6add4c3563be36628bde1c5b314f5d0765d","test/test_time.rs":"f7a21b1e279e60e84909d5dadda97ded66d3326b131fe317badf9af0a1b50335","test/test_timer.rs":"3ae20d364f075d2811f3ff94eda9886682cc21d8807656007d2464fe36d1e361","test/test_unistd.rs":"20a00be4fbe26302ea5fe50ce25b99265dc763db138663d6aa1d7ac729a1d292"},"package":"bfdda3d196821d6af13126e40375cdf7da646a96114af134d5f417a9a1dc8e1a"}
\ 文件尾没有换行符

--- a/third_party/rust/nix/src/sys/ioctl/linux.rs	2023-06-01 09:14:39.000000000 +0800
+++ b/third_party/rust/nix/src/sys/ioctl/linux.rs	2023-06-05 01:23:36.000000000 +0800
@@ -41,6 +41,7 @@
     target_arch = "s390x",
     target_arch = "x86_64",
     target_arch = "aarch64",
+    target_arch = "loongarch64",
     target_arch = "riscv32",
     target_arch = "riscv64"
 ))]
```
```sh
patch -p1 -d thunderbird-114.0 < nix.patch
```

### third\_party/rust/cty
* cty.path

```diff
--- a/third_party/rust/cty/.cargo-checksum.json	2023-06-05 12:01:58.182619216 +0800
+++ b/third_party/rust/cty/.cargo-checksum.json	2023-06-05 12:04:50.000000000 +0800
@@ -1 +1 @@
-{"files":{"CHANGELOG.md":"077c738b5f2c05d66a12209edaabca887091db727d61164a7a414da23d8bf08f","Cargo.toml":"94a517ea6c7dad4634a9a2bd356f3a8035927e7ff8367bd5a975b4db4ccf8e6e","LICENSE-APACHE":"a60eea817514531668d7e00765731449fe14d059d3249e0bc93b36de45f759f2","LICENSE-MIT":"035e70219855119df4273b3c5b97543ae82e0dd60c520416e759107c602f651b","README.md":"19687c50697e6abc991e4c35e6d674db56bd5e5ae0d5b833440718f8f154a74d","ci/install.sh":"9b34273d9e79ec59f63d5e3e7aea27b0db66194667f9730a21158740fa1b99f1","ci/script.sh":"54962430ca4d3528e5c0d44ff590b1504be13147db5cbe8bb82f1358528ef5f3","src/lib.rs":"33a38ce6df718fb0191f34ff2cefdcbd3ad9d93f0c4073b78eaf937c07fb7614"},"package":"b365fabc795046672053e29c954733ec3b05e4be654ab130fe8f1f94d7051f35"}
\ 文件尾没有换行符
+{"files":{"CHANGELOG.md":"077c738b5f2c05d66a12209edaabca887091db727d61164a7a414da23d8bf08f","Cargo.toml":"94a517ea6c7dad4634a9a2bd356f3a8035927e7ff8367bd5a975b4db4ccf8e6e","LICENSE-APACHE":"a60eea817514531668d7e00765731449fe14d059d3249e0bc93b36de45f759f2","LICENSE-MIT":"035e70219855119df4273b3c5b97543ae82e0dd60c520416e759107c602f651b","README.md":"19687c50697e6abc991e4c35e6d674db56bd5e5ae0d5b833440718f8f154a74d","ci/install.sh":"9b34273d9e79ec59f63d5e3e7aea27b0db66194667f9730a21158740fa1b99f1","ci/script.sh":"54962430ca4d3528e5c0d44ff590b1504be13147db5cbe8bb82f1358528ef5f3","src/lib.rs":"e0e3c6a74636b23483e8c41b2cbf1245b2ea68567d73588df434d62af7038903"},"package":"b365fabc795046672053e29c954733ec3b05e4be654ab130fe8f1f94d7051f35"}
\ 文件尾没有换行符
diff --color -Nru third_party/rust/cty-orig/src/lib.rs third_party/rust/cty/src/lib.rs
--- third_party/rust/cty-orig/src/lib.rs	2023-06-05 12:01:58.166619411 +0800
+++ third_party/rust/cty/src/lib.rs	2023-06-05 12:02:42.050084151 +0800
@@ -45,6 +45,7 @@
 
 #[cfg(any(target_arch = "mips",
           target_arch = "mips64",
+          target_arch = "loongarch64",
           target_arch = "sparc64",
           target_arch = "x86",
           target_arch = "x86_64",
```
```sh
patch -p1 -d thunderbird-114.0 < cty.patch
```

*   有人指出这个crate已经不再维护了。因为它提供的功能已经被`core`提供了。但是FF还在用这个。(这样搞得LA的支持一直进不去)
*   难到要去动FF那边的代码。让它不再依赖这个？

### third\_party/rust/authenticator
* authenticator.patch
```diff
--- a/third_party/rust/authenticator/build.rs	2023-06-05 12:29:33.246709053 +0800
+++ b/third_party/rust/authenticator/build.rs	2023-06-05 12:30:31.000000000 +0800
@@ -47,6 +47,8 @@
         "ioctl_s390xbe.rs"
     } else if cfg!(all(target_arch = "riscv64", target_endian = "little")) {
         "ioctl_riscv64.rs"
+    } else if cfg!(all(target_arch = "loongarch64", target_endian = "little")) {
+        "ioctl_loongarch64.rs"        
     } else {
         panic!("architecture not supported");
     };

--- a/third_party/rust/authenticator/.cargo-checksum.json	2023-06-05 12:29:33.258708910 +0800
+++ b/third_party/rust/authenticator/.cargo-checksum.json	2023-06-05 12:32:27.000000000 +0800
@@ -1 +1 @@
-{"files":{"Cargo.lock":"0c293d2be0bf21fd2282ecfc77ff23fa45f69ec037b96c7b99ef3bddcbc2350b","Cargo.toml":"ad6277aa6cca1dcb09544608f384794b09a6de1a81c23d511ce0b9946242c760","Cross.toml":"8d132da818d48492aa9f4b78a348f0df3adfae45d988d42ebd6be8a5adadb6c3","LICENSE":"e866c8f5864d4cacfe403820e722e9dc03fe3c7565efa5e4dad9051d827bb92a","README.md":"c87d9c7cc44f1dd4ef861a3a9f8cd2eb68aedd3814768871f5fb63c2070806cd","build.rs":"01092254718e4cd5d6bffcd64d55cc3240dc00e79f3d7344a5dc4abf6c27bca6","examples/ctap2.rs":"b56894078e5a49ede4c5c6fa10db5620049d55f0bde31834a04cc2087d618000","examples/ctap2_discoverable_creds.rs":"f683c2eac77f24bed57ddc1c9be2e67b37c8e3084ca4da4db9d1621da7beebf0","examples/interactive_management.rs":"2b3f7d9fc4f9d32806fa4974211b15a160ea26ae39138b4058d0a78dd1ee2fab","examples/reset.rs":"f6e03955cc5e40d6c7372031448faf78a2236479d4cba96a2ec36a804c65b89b","examples/set_pin.rs":"c220aeaf94d4b1f82314ee012a5ca2b487e263d261d14a2e38069b25004b7a90","examples/test_exclude_list.rs":"f6f24e03dea22391efcd9182055724980a05b0b6a52e0f6472b9d407e377de6a","rustfmt.toml":"ceb6615363d6fff16426eb56f5727f98a7f7ed459ba9af735b1d8b672e2c3b9b","src/authenticatorservice.rs":"dc756ae9d420dac187b04afbb4831527c12fa307ef072f1c1cb4480df9cbda5f","src/consts.rs":"d7b274ec55e56a8d2c150df28e23d72a7379e5bd7257d53d63c2a7b59ab90800","src/crypto/dummy.rs":"9cc6be0dc1e28c7328121e7a4bf435211ae8b1455784472b24993571c4009579","src/crypto/mod.rs":"dae4a08f6994b6bbd9df40fda10f0337a4cdd95527caf34fd52d756d725e1c53","src/crypto/nss.rs":"2bf33898728760f194f204876450d0906b47907d259270f6e3d43c62a709c99a","src/crypto/openssl.rs":"ef6e4dbcc7230137e505e3fc4ad37e102e6b26b37470afd0f4709a297b3aa546","src/ctap2/attestation.rs":"5e23b9895ae763ebdcdfd1f2417d5b1773609c7c60cfc27ce9eb34e55281918a","src/ctap2/client_data.rs":"04ee84b34e91c988183871b4975fc08e12234965187c793ad26d0d82ed44642f","src/ctap2/commands/client_pin.rs":"40aeb673084a9ef1d3288e7107162ca1084f8d5cc762bad3e32f3f54e1e75fc2","src/ctap2/commands/get_assertion.rs":"8a141a198deff2f44fce57760afb31e2f9fb28c77b2a49d9fe0009cd618f5745","src/ctap2/commands/get_info.rs":"c3a1c66279cb007aa4e19d29eadd84abc7d84d7763c9a05de17047f4baa8a692","src/ctap2/commands/get_next_assertion.rs":"1120b0301197ada11751c4c42fc0a4147368ec5427f62da3868347567d28ba3a","src/ctap2/commands/get_version.rs":"e7e2f83ead1c9d6d8611513120e1ac354109cff8e14dce5c3073a5c1fa677d71","src/ctap2/commands/make_credentials.rs":"17cdad6efcda5a468852bde14e7152c7abae0df009b4f003bdb9eff325afcb2e","src/ctap2/commands/mod.rs":"ee7869a42082acde4909e08f9d2a3c955777f1414fa09b573baeac9a95b360f2","src/ctap2/commands/reset.rs":"95dac8a400f66fb4725a3850a06d6b605ffc99bec4a90ca302a6e8f21deb48d8","src/ctap2/commands/selection.rs":"a2a4b2e30df1923c296f7ac3a8d38cfcac7c231669cfc39babcb7b02fac7cdee","src/ctap2/mod.rs":"672c581502ac6d1417d0fe42a92ef86b1f1d64799f48061b3d9ac026e35fb69d","src/ctap2/server.rs":"98ab464cb4368a57f4f0688fe6de3ca46e781aa6fdc5d0e6ada855be4b412efd","src/ctap2/utils.rs":"ad0aa36a0dbeb510b7f37789329f1957eab206eb529dc083e6176b142984e26e","src/errors.rs":"2fb7117e8cd87aafe305bb997c83dc91edd42e5528b0dc2d5e24cfac9597e8d7","src/lib.rs":"144ca5f912189bc9b50b47fbc8d2b776cdc5fe216a1d7754eee7180e19f724ca","src/manager.rs":"d72f8523d0a549487504ef6d370aee9132ad7436aaae777e6d65a0a03f3c0c27","src/statecallback.rs":"6b16f97176db1ae3fc3851fe8394e4ffc324bc6fe59313845ac3a88132fd52f1","src/statemachine.rs":"7c30ff7f5c005844cad1b9ba1341b6f10811a8c0ce4a02fafa1273fa166e2cee","src/status_update.rs":"45ae7897de9f676f3e3c63082c8e37f4cf6fa044f2111bf3337dd56180791df8","src/transport/device_selector.rs":"c703aa8e59b0b7ac9d11be0aac434dffda8b0c91e1a84298c48e598978e1576e","src/transport/errors.rs":"5af7cb8d22ffa63bf4264d182a0f54b9b3a2cc9d19d832b3495857229f9a2875","src/transport/freebsd/device.rs":"f41c7cf29c48bf2b403cf460e6387864372a134d6daeefc5c3afc3f40d0d4575","src/transport/freebsd/mod.rs":"42dcb57fbeb00140003a8ad39acac9b547062b8f281a3fa5deb5f92a6169dde6","src/transport/freebsd/monitor.rs":"a6b34af4dd2e357a5775b1f3a723766107c11ef98dba859b1188ed08e0e450a2","src/transport/freebsd/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/freebsd/uhid.rs":"a194416a8bc5d428c337f8d96a2248769ca190810852bbe5ee686ab595d8eb4c","src/transport/hid.rs":"d0879b98abfb765cdc88281d47a9976fd7537971d660836ca74a3fc4405fd6a6","src/transport/hidproto.rs":"9d490f161807b75f4d7d5096355006627c1f47c0d90fca53bade3692efc92a2d","src/transport/linux/device.rs":"e79bd06d98723a0d7e4f25b7cf2ac3e0260b10e52d2b0695909d2932288e10a4","src/transport/linux/hidraw.rs":"c7a0df9b4e51cb2736218ffffa02b2b2547b7c515d69f9bae2c9a8c8f1cb547b","src/transport/linux/hidwrapper.h":"72785db3a9b27ea72b6cf13a958fee032af54304522d002f56322473978a20f9","src/transport/linux/hidwrapper.rs":"753c7459dbb73befdd186b6269ac33f7a4537b4c935928f50f2b2131756e787d","src/transport/linux/ioctl_aarch64le.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_armle.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_mips64le.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_mipsbe.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_mipsle.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_powerpc64be.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_powerpc64le.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_powerpcbe.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_riscv64.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_s390xbe.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_x86.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_x86_64.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/mod.rs":"446e435126d2a58f167f648dd95cba28e8ac9c17f1f799e1eaeab80ea800fc57","src/transport/linux/monitor.rs":"5e3ec2618dd74027ae6ca1527991254e3271cce59106d4920ce0414094e22f64","src/transport/linux/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/macos/device.rs":"f508d0585079ecf87a73d6135c52e8b5a887fbf16e241676d51a8099a8001a81","src/transport/macos/iokit.rs":"7dc4e7bbf8e42e2fcde0cee8e48d14d6234a5a910bd5d3c4e966d8ba6b73992f","src/transport/macos/mod.rs":"333e561554fc901d4f6092f6e4c85823e2b0c4ff31c9188d0e6d542b71a0a07c","src/transport/macos/monitor.rs":"e02288454bb4010e06b705d82646abddb3799f0cd655f574aa19f9d91485a4a2","src/transport/macos/transaction.rs":"9dcdebd13d5fd5a185b5ad777a80c825a6ba5e76b141c238aa115b451b9a72fa","src/transport/mock/device.rs":"582b2b55f13d95dd9f1127e3dde49d2137a5ca020f9c1fa1ffa5c4083d05c0e7","src/transport/mock/mod.rs":"9c4c87efd19adddc1a91c699a6c328063cfbac5531b76346a5ff92e986aded8f","src/transport/mock/transaction.rs":"be3ed8c389dfa04122364b82515edd76fad6f5d5f72d15cacd45a84fb8397292","src/transport/mod.rs":"2c35da1ef07ba8119bb003fc9ad7944ae81469469147be3752bdc1d2c2e8aea3","src/transport/netbsd/device.rs":"a7dec83b5040faf1a8ddb37e9fc2b45b9b12814be4802b3b351eff081d1b80c3","src/transport/netbsd/fd.rs":"5464019025d03ea2a39c82f76b238bbbdb0ea63f5a5fc7c9d974e235139cd53b","src/transport/netbsd/mod.rs":"b1c52aa29537330cebe67427062d6c94871cab2a9b0c04b2305d686f07e88fd5","src/transport/netbsd/monitor.rs":"fb2917e4ba53cc9867987a539061f82d011f4c6e478df1157d965d32df2eb922","src/transport/netbsd/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/netbsd/uhid.rs":"d15be35e2413240066a8f086bb8846b08a6a92bf6a1941c3eec1329dd3a4f9ce","src/transport/openbsd/device.rs":"47d8dfeb12c33e6cada2b2cd76476827059c797d8a16f2c4aea6e78d32ebab46","src/transport/openbsd/mod.rs":"514274d414042ff84b3667a41a736e78581e22fda87ccc97c2bc05617e381a30","src/transport/openbsd/monitor.rs":"2e0ba6ecc69b450be9cbfd21a7c65036ed2ce593b12363596d3eae0b5bfb79e8","src/transport/openbsd/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/stub/device.rs":"aa21711d6690ed68bd878b28463172ba69c6324be7afabeccb1f07b4831cb020","src/transport/stub/mod.rs":"6a7fec504a52d403b0241b18cd8b95088a31807571f4c0a67e4055afc74f4453","src/transport/stub/transaction.rs":"c9a3ade9562468163f28fd51e7ff3e0bf5854b7edade9e987000d11c5d0e62d2","src/transport/windows/device.rs":"148b1572ed5fa8d476efbdb2a3a35608ec23012d6a805129f3c25c453bab4b7a","src/transport/windows/mod.rs":"218e7f2fe91ecb390c12bba5a5ffdad2c1f0b22861c937f4d386262e5b3dd617","src/transport/windows/monitor.rs":"95913d49e7d83482e420493d89b53ffceb6a49e646a87de934dff507b3092b4c","src/transport/windows/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/windows/winapi.rs":"b2a4cc85f14e39cadfbf068ee001c9d776f028d3cf09cb926d4364c5b437c112","src/u2fprotocol.rs":"e61ac223aab79ae82383cd32a23213d18461e229c448373bf2483357a9eae69e","src/u2ftypes.rs":"8511c6f04f69670ddd403178a46060644a27128ca4077a9a3e00bc6671e3864b","src/util.rs":"cf37c4c3caf6dde4fc3cf6f5f297ed3c0f13bcb50fb0e8955899fc837483ef31","src/virtualdevices/mod.rs":"2c7df7691d5c150757304241351612aed4260d65b70ab0f483edbc1a5cfb5674","src/virtualdevices/software_u2f.rs":"83e63c0c4a597e71d87b5cd1f33a49646d00b3062edbdd05c51623b80fb60168","src/virtualdevices/webdriver/mod.rs":"4a36e6dfa9f45f941d863b4039bfbcfa8eaca660bd6ed78aeb1a2962db64be5a","src/virtualdevices/webdriver/testtoken.rs":"7146e02f1a5dad2c8827dd11c12ee408c0e42a0706ac65f139998feffd42570f","src/virtualdevices/webdriver/virtualmanager.rs":"7205a0397833628fc0847aa942a6a314dc1e23306858b546053e0de6a360ebe1","src/virtualdevices/webdriver/web_api.rs":"9032525af458b6fe9a3274c36b6ef8c791ecc4ec46d38ae36583fc9a4535b59d","testing/cross/powerpc64le-unknown-linux-gnu.Dockerfile":"d7463ff4376e3e0ca3fed879fab4aa975c4c0a3e7924c5b88aef9381a5d013de","testing/cross/x86_64-unknown-linux-gnu.Dockerfile":"11c79c04b07a171b0c9b63ef75fa75f33263ce76e3c1eda0879a3e723ebd0c24","testing/run_cross.sh":"cc2a7e0359f210eba2e7121f81eb8ab0125cea6e0d0f2698177b0fe2ad0c33d8","webdriver-tools/requirements.txt":"8236aa3dedad886f213c9b778fec80b037212d30e640b458984110211d546005","webdriver-tools/webdriver-driver.py":"82327c26ba271d1689acc87b612ab8436cb5475f0a3c0dba7baa06e7f6f5e19c"},"package":"9f3aaf9a8213bf1a4cfafca1a38befe0873a2a4d8013136d2dd12227e14bb2ba"}
\ 文件尾没有换行符
+{"files":{"Cargo.lock":"0c293d2be0bf21fd2282ecfc77ff23fa45f69ec037b96c7b99ef3bddcbc2350b","Cargo.toml":"ad6277aa6cca1dcb09544608f384794b09a6de1a81c23d511ce0b9946242c760","Cross.toml":"8d132da818d48492aa9f4b78a348f0df3adfae45d988d42ebd6be8a5adadb6c3","LICENSE":"e866c8f5864d4cacfe403820e722e9dc03fe3c7565efa5e4dad9051d827bb92a","README.md":"c87d9c7cc44f1dd4ef861a3a9f8cd2eb68aedd3814768871f5fb63c2070806cd","build.rs":"6e7bee368605c92cdc1977efdbe7e4e8bbe5afb6394c5c49f2da7f79fa0639eb","examples/ctap2.rs":"b56894078e5a49ede4c5c6fa10db5620049d55f0bde31834a04cc2087d618000","examples/ctap2_discoverable_creds.rs":"f683c2eac77f24bed57ddc1c9be2e67b37c8e3084ca4da4db9d1621da7beebf0","examples/interactive_management.rs":"2b3f7d9fc4f9d32806fa4974211b15a160ea26ae39138b4058d0a78dd1ee2fab","examples/reset.rs":"f6e03955cc5e40d6c7372031448faf78a2236479d4cba96a2ec36a804c65b89b","examples/set_pin.rs":"c220aeaf94d4b1f82314ee012a5ca2b487e263d261d14a2e38069b25004b7a90","examples/test_exclude_list.rs":"f6f24e03dea22391efcd9182055724980a05b0b6a52e0f6472b9d407e377de6a","rustfmt.toml":"ceb6615363d6fff16426eb56f5727f98a7f7ed459ba9af735b1d8b672e2c3b9b","src/authenticatorservice.rs":"dc756ae9d420dac187b04afbb4831527c12fa307ef072f1c1cb4480df9cbda5f","src/consts.rs":"d7b274ec55e56a8d2c150df28e23d72a7379e5bd7257d53d63c2a7b59ab90800","src/crypto/dummy.rs":"9cc6be0dc1e28c7328121e7a4bf435211ae8b1455784472b24993571c4009579","src/crypto/mod.rs":"dae4a08f6994b6bbd9df40fda10f0337a4cdd95527caf34fd52d756d725e1c53","src/crypto/nss.rs":"2bf33898728760f194f204876450d0906b47907d259270f6e3d43c62a709c99a","src/crypto/openssl.rs":"ef6e4dbcc7230137e505e3fc4ad37e102e6b26b37470afd0f4709a297b3aa546","src/ctap2/attestation.rs":"5e23b9895ae763ebdcdfd1f2417d5b1773609c7c60cfc27ce9eb34e55281918a","src/ctap2/client_data.rs":"04ee84b34e91c988183871b4975fc08e12234965187c793ad26d0d82ed44642f","src/ctap2/commands/client_pin.rs":"40aeb673084a9ef1d3288e7107162ca1084f8d5cc762bad3e32f3f54e1e75fc2","src/ctap2/commands/get_assertion.rs":"8a141a198deff2f44fce57760afb31e2f9fb28c77b2a49d9fe0009cd618f5745","src/ctap2/commands/get_info.rs":"c3a1c66279cb007aa4e19d29eadd84abc7d84d7763c9a05de17047f4baa8a692","src/ctap2/commands/get_next_assertion.rs":"1120b0301197ada11751c4c42fc0a4147368ec5427f62da3868347567d28ba3a","src/ctap2/commands/get_version.rs":"e7e2f83ead1c9d6d8611513120e1ac354109cff8e14dce5c3073a5c1fa677d71","src/ctap2/commands/make_credentials.rs":"17cdad6efcda5a468852bde14e7152c7abae0df009b4f003bdb9eff325afcb2e","src/ctap2/commands/mod.rs":"ee7869a42082acde4909e08f9d2a3c955777f1414fa09b573baeac9a95b360f2","src/ctap2/commands/reset.rs":"95dac8a400f66fb4725a3850a06d6b605ffc99bec4a90ca302a6e8f21deb48d8","src/ctap2/commands/selection.rs":"a2a4b2e30df1923c296f7ac3a8d38cfcac7c231669cfc39babcb7b02fac7cdee","src/ctap2/mod.rs":"672c581502ac6d1417d0fe42a92ef86b1f1d64799f48061b3d9ac026e35fb69d","src/ctap2/server.rs":"98ab464cb4368a57f4f0688fe6de3ca46e781aa6fdc5d0e6ada855be4b412efd","src/ctap2/utils.rs":"ad0aa36a0dbeb510b7f37789329f1957eab206eb529dc083e6176b142984e26e","src/errors.rs":"2fb7117e8cd87aafe305bb997c83dc91edd42e5528b0dc2d5e24cfac9597e8d7","src/lib.rs":"144ca5f912189bc9b50b47fbc8d2b776cdc5fe216a1d7754eee7180e19f724ca","src/manager.rs":"d72f8523d0a549487504ef6d370aee9132ad7436aaae777e6d65a0a03f3c0c27","src/statecallback.rs":"6b16f97176db1ae3fc3851fe8394e4ffc324bc6fe59313845ac3a88132fd52f1","src/statemachine.rs":"7c30ff7f5c005844cad1b9ba1341b6f10811a8c0ce4a02fafa1273fa166e2cee","src/status_update.rs":"45ae7897de9f676f3e3c63082c8e37f4cf6fa044f2111bf3337dd56180791df8","src/transport/device_selector.rs":"c703aa8e59b0b7ac9d11be0aac434dffda8b0c91e1a84298c48e598978e1576e","src/transport/errors.rs":"5af7cb8d22ffa63bf4264d182a0f54b9b3a2cc9d19d832b3495857229f9a2875","src/transport/freebsd/device.rs":"f41c7cf29c48bf2b403cf460e6387864372a134d6daeefc5c3afc3f40d0d4575","src/transport/freebsd/mod.rs":"42dcb57fbeb00140003a8ad39acac9b547062b8f281a3fa5deb5f92a6169dde6","src/transport/freebsd/monitor.rs":"a6b34af4dd2e357a5775b1f3a723766107c11ef98dba859b1188ed08e0e450a2","src/transport/freebsd/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/freebsd/uhid.rs":"a194416a8bc5d428c337f8d96a2248769ca190810852bbe5ee686ab595d8eb4c","src/transport/hid.rs":"d0879b98abfb765cdc88281d47a9976fd7537971d660836ca74a3fc4405fd6a6","src/transport/hidproto.rs":"9d490f161807b75f4d7d5096355006627c1f47c0d90fca53bade3692efc92a2d","src/transport/linux/device.rs":"e79bd06d98723a0d7e4f25b7cf2ac3e0260b10e52d2b0695909d2932288e10a4","src/transport/linux/hidraw.rs":"c7a0df9b4e51cb2736218ffffa02b2b2547b7c515d69f9bae2c9a8c8f1cb547b","src/transport/linux/hidwrapper.h":"72785db3a9b27ea72b6cf13a958fee032af54304522d002f56322473978a20f9","src/transport/linux/hidwrapper.rs":"d203e8804e7632b8d47a224c186d1f431800f04ddc43360d5c086f71e9b0f674","src/transport/linux/ioctl_aarch64le.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_armle.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_mips64le.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_mipsbe.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_mipsle.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_powerpc64be.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_powerpc64le.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_powerpcbe.rs":"fbda309934ad8bda689cd4fb5c0ca696fe26dedb493fe9d5a5322c3047d474fd","src/transport/linux/ioctl_riscv64.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_s390xbe.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_x86.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/ioctl_x86_64.rs":"2d8b265cd39a9f46816f83d5a5df0701c13eb842bc609325bad42ce50add3bf0","src/transport/linux/mod.rs":"446e435126d2a58f167f648dd95cba28e8ac9c17f1f799e1eaeab80ea800fc57","src/transport/linux/monitor.rs":"5e3ec2618dd74027ae6ca1527991254e3271cce59106d4920ce0414094e22f64","src/transport/linux/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/macos/device.rs":"f508d0585079ecf87a73d6135c52e8b5a887fbf16e241676d51a8099a8001a81","src/transport/macos/iokit.rs":"7dc4e7bbf8e42e2fcde0cee8e48d14d6234a5a910bd5d3c4e966d8ba6b73992f","src/transport/macos/mod.rs":"333e561554fc901d4f6092f6e4c85823e2b0c4ff31c9188d0e6d542b71a0a07c","src/transport/macos/monitor.rs":"e02288454bb4010e06b705d82646abddb3799f0cd655f574aa19f9d91485a4a2","src/transport/macos/transaction.rs":"9dcdebd13d5fd5a185b5ad777a80c825a6ba5e76b141c238aa115b451b9a72fa","src/transport/mock/device.rs":"582b2b55f13d95dd9f1127e3dde49d2137a5ca020f9c1fa1ffa5c4083d05c0e7","src/transport/mock/mod.rs":"9c4c87efd19adddc1a91c699a6c328063cfbac5531b76346a5ff92e986aded8f","src/transport/mock/transaction.rs":"be3ed8c389dfa04122364b82515edd76fad6f5d5f72d15cacd45a84fb8397292","src/transport/mod.rs":"2c35da1ef07ba8119bb003fc9ad7944ae81469469147be3752bdc1d2c2e8aea3","src/transport/netbsd/device.rs":"a7dec83b5040faf1a8ddb37e9fc2b45b9b12814be4802b3b351eff081d1b80c3","src/transport/netbsd/fd.rs":"5464019025d03ea2a39c82f76b238bbbdb0ea63f5a5fc7c9d974e235139cd53b","src/transport/netbsd/mod.rs":"b1c52aa29537330cebe67427062d6c94871cab2a9b0c04b2305d686f07e88fd5","src/transport/netbsd/monitor.rs":"fb2917e4ba53cc9867987a539061f82d011f4c6e478df1157d965d32df2eb922","src/transport/netbsd/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/netbsd/uhid.rs":"d15be35e2413240066a8f086bb8846b08a6a92bf6a1941c3eec1329dd3a4f9ce","src/transport/openbsd/device.rs":"47d8dfeb12c33e6cada2b2cd76476827059c797d8a16f2c4aea6e78d32ebab46","src/transport/openbsd/mod.rs":"514274d414042ff84b3667a41a736e78581e22fda87ccc97c2bc05617e381a30","src/transport/openbsd/monitor.rs":"2e0ba6ecc69b450be9cbfd21a7c65036ed2ce593b12363596d3eae0b5bfb79e8","src/transport/openbsd/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/stub/device.rs":"aa21711d6690ed68bd878b28463172ba69c6324be7afabeccb1f07b4831cb020","src/transport/stub/mod.rs":"6a7fec504a52d403b0241b18cd8b95088a31807571f4c0a67e4055afc74f4453","src/transport/stub/transaction.rs":"c9a3ade9562468163f28fd51e7ff3e0bf5854b7edade9e987000d11c5d0e62d2","src/transport/windows/device.rs":"148b1572ed5fa8d476efbdb2a3a35608ec23012d6a805129f3c25c453bab4b7a","src/transport/windows/mod.rs":"218e7f2fe91ecb390c12bba5a5ffdad2c1f0b22861c937f4d386262e5b3dd617","src/transport/windows/monitor.rs":"95913d49e7d83482e420493d89b53ffceb6a49e646a87de934dff507b3092b4c","src/transport/windows/transaction.rs":"ec28475a70dded260f9a7908c7f88dd3771f5d64b9a5dda835411d13b713c39a","src/transport/windows/winapi.rs":"b2a4cc85f14e39cadfbf068ee001c9d776f028d3cf09cb926d4364c5b437c112","src/u2fprotocol.rs":"e61ac223aab79ae82383cd32a23213d18461e229c448373bf2483357a9eae69e","src/u2ftypes.rs":"8511c6f04f69670ddd403178a46060644a27128ca4077a9a3e00bc6671e3864b","src/util.rs":"cf37c4c3caf6dde4fc3cf6f5f297ed3c0f13bcb50fb0e8955899fc837483ef31","src/virtualdevices/mod.rs":"2c7df7691d5c150757304241351612aed4260d65b70ab0f483edbc1a5cfb5674","src/virtualdevices/software_u2f.rs":"83e63c0c4a597e71d87b5cd1f33a49646d00b3062edbdd05c51623b80fb60168","src/virtualdevices/webdriver/mod.rs":"4a36e6dfa9f45f941d863b4039bfbcfa8eaca660bd6ed78aeb1a2962db64be5a","src/virtualdevices/webdriver/testtoken.rs":"7146e02f1a5dad2c8827dd11c12ee408c0e42a0706ac65f139998feffd42570f","src/virtualdevices/webdriver/virtualmanager.rs":"7205a0397833628fc0847aa942a6a314dc1e23306858b546053e0de6a360ebe1","src/virtualdevices/webdriver/web_api.rs":"9032525af458b6fe9a3274c36b6ef8c791ecc4ec46d38ae36583fc9a4535b59d","testing/cross/powerpc64le-unknown-linux-gnu.Dockerfile":"d7463ff4376e3e0ca3fed879fab4aa975c4c0a3e7924c5b88aef9381a5d013de","testing/cross/x86_64-unknown-linux-gnu.Dockerfile":"11c79c04b07a171b0c9b63ef75fa75f33263ce76e3c1eda0879a3e723ebd0c24","testing/run_cross.sh":"cc2a7e0359f210eba2e7121f81eb8ab0125cea6e0d0f2698177b0fe2ad0c33d8","webdriver-tools/requirements.txt":"8236aa3dedad886f213c9b778fec80b037212d30e640b458984110211d546005","webdriver-tools/webdriver-driver.py":"82327c26ba271d1689acc87b612ab8436cb5475f0a3c0dba7baa06e7f6f5e19c"},"package":"9f3aaf9a8213bf1a4cfafca1a38befe0873a2a4d8013136d2dd12227e14bb2ba"}
\ 文件尾没有换行符

--- a/third_party/rust/authenticator/src/transport/linux/hidwrapper.rs	2023-06-05 12:29:33.210709480 +0800
+++ b/third_party/rust/authenticator/src/transport/linux/hidwrapper.rs	2023-06-05 12:31:33.000000000 +0800
@@ -49,3 +49,6 @@
 
 #[cfg(all(target_arch = "riscv64", target_endian = "little"))]
 include!("ioctl_riscv64.rs");
+
+#[cfg(all(target_arch = "loongarch64", target_endian = "little"))]
+include!("ioctl_loongarch64.rs");

--- a/third_party/rust/authenticator/src/transport/linux/ioctl_loongarch64.rs	1970-01-01 08:00:00.000000000 +0800
+++ b/third_party/rust/authenticator/src/transport/linux/ioctl_loongarch64.rs	2023-06-05 12:31:48.000000000 +0800
@@ -0,0 +1,5 @@
+/* automatically generated by rust-bindgen */
+
+pub type __u32 = ::std::os::raw::c_uint;
+pub const _HIDIOCGRDESCSIZE: __u32 = 2147764225;
+pub const _HIDIOCGRDESC: __u32 = 2416199682;
\ 文件尾没有换行符
```
```sh
patch -p1 -d thunderbird-114.0 < authenticator.patch
```

### third\_party/libwebrtc/build/build\_config.h
* webrtc_config.patch
```diff
--- a/third_party/libwebrtc/build/build_config.h	2023-06-05 13:43:00.877924504 +0800
+++ b/third_party/libwebrtc/build/build_config.h	2023-06-05 13:44:55.564549320 +0800
@@ -173,6 +173,11 @@
 #elif defined(__pnacl__) || defined(__asmjs__) || defined(__wasm__)
 #define ARCH_CPU_32_BITS 1
 #define ARCH_CPU_LITTLE_ENDIAN 1
+#elif defined(__loongarch64)
+#define ARCH_CPU_LOONG_FAMILY 1
+#define ARCH_CPU_LOONG64 1
+#define ARCH_CPU_64_BITS 1
+#define ARCH_CPU_LITTLE_ENDIAN 1
 #elif defined(__MIPSEL__)
 #if defined(__LP64__)
 #define ARCH_CPU_MIPS_FAMILY 1
```
```sh
patch -p1 -d thunderbird-114.0 < webrtc_config.patch
```

### js/src/old-configure.in
* js_relro.patch //我不确定这个和下一个是否必要
```diff
--- a/js/src/old-configure.in	2023-06-05 14:02:27.227939022 +0800
+++ b/js/src/old-configure.in	2023-06-05 14:03:31.191172051 +0800
@@ -214,7 +214,7 @@
 
     AC_MSG_CHECKING([for -z relro option to ld])
     _SAVE_LDFLAGS=$LDFLAGS
-    LDFLAGS="$LDFLAGS -Wl,-z,relro"
+    #LDFLAGS="$LDFLAGS -Wl,-z,relro"
     AC_TRY_LINK(,,AC_MSG_RESULT([yes]),
                   AC_MSG_RESULT([no])
                   LDFLAGS=$_SAVE_LDFLAGS)
```
```sh
patch -p1 -d thunderbird-114.0 < js_relro.patch
```

### old-configure.in
* root_relo.patch
```diff
--- a/old-configure.in	2023-06-05 14:10:13.444750758 +0800
+++ b/old-configure.in	2023-06-05 14:10:26.408702096 +0800
@@ -213,14 +213,14 @@
 
     AC_MSG_CHECKING([for -z text option to ld])
     _SAVE_LDFLAGS=$LDFLAGS
-    LDFLAGS="$LDFLAGS -Wl,-z,text"
+    #LDFLAGS="$LDFLAGS -Wl,-z,text"
     AC_TRY_LINK(,,AC_MSG_RESULT([yes]),
                   AC_MSG_RESULT([no])
                   LDFLAGS=$_SAVE_LDFLAGS)
 
     AC_MSG_CHECKING([for -z relro option to ld])
     _SAVE_LDFLAGS=$LDFLAGS
-    LDFLAGS="$LDFLAGS -Wl,-z,relro"
+    #LDFLAGS="$LDFLAGS -Wl,-z,relro"
     AC_TRY_LINK(,,AC_MSG_RESULT([yes]),
                   AC_MSG_RESULT([no])
                   LDFLAGS=$_SAVE_LDFLAGS)
```
```sh
patch -p1 -d thunderbird-114.0 < root_relo.patch
```

### python/mozbuild/mozbuild/test/configure/test\_toolchain\_configure.py
* test_toolchain_configure.patch
```diff
--- a/python/mozbuild/mozbuild/test/configure/test_toolchain_configure.py	2023-06-05 14:15:21.047105715 +0800
+++ b/python/mozbuild/mozbuild/test/configure/test_toolchain_configure.py	2023-06-05 14:15:39.054983481 +0800
@@ -1335,6 +1335,7 @@
         "m68k-unknown-linux-gnu": big_endian + {"__m68k__": 1},
         "mips64-unknown-linux-gnuabi64": big_endian + {"__mips64": 1, "__mips__": 1},
         "mips-unknown-linux-gnu": big_endian + {"__mips__": 1},
+        'loongarch64-unknown-linux-gnuabi64': little_endian + {'__loongarch64': 1,'__loongarch__': 1,},
         "riscv64-unknown-linux-gnu": little_endian + {"__riscv": 1, "__riscv_xlen": 64},
         "sh4-unknown-linux-gnu": little_endian + {"__sh__": 1},
     }
```
```sh
patch -p1 -d thunderbird-114.0 < test_toolchain_configure.patch
```

### /xpcom/reflect/xptcall/md/unix/
* xpcom.patch
```diff
--- a/xpcom/reflect/xptcall/md/unix/moz.build	2023-06-05 14:21:27.360254947 +0800
+++ b/xpcom/reflect/xptcall/md/unix/moz.build	2023-06-05 14:22:10.207882546 +0800
@@ -135,6 +135,13 @@
             ASFLAGS += [
                 "-fno-integrated-as",
             ]
+    if CONFIG['CPU_ARCH'] == 'loongarch64':
+         SOURCES += [
+             'xptcinvoke_asm_loongarch64.S',
+             'xptcinvoke_loongarch64.cpp',
+             'xptcstubs_asm_loongarch64.S',
+             'xptcstubs_loongarch64.cpp',
+         ]
     if CONFIG["CPU_ARCH"] == "mips32":
         SOURCES += [
             "xptcinvoke_asm_mips.S",


--- /dev/null	1970-01-01 08:00:00.000000000 +0800
+++ b/xpcom/reflect/xptcall/md/unix/xptc_asm_loongarch_unix.h	2023-06-05 14:22:47.291555399 +0800
@@ -0,0 +1,127 @@
+#ifndef _XPTC_ASM_LOONGARCH_UNIX_H
+#define _XPTC_ASM_LOONGARCH_UNIX_H
+
+
+/*
+ * Symbolic register names
+ */
+# define zero     $r0
+# define ra       $r1
+# define gp       $r2
+# define sp       $r3
+# define a0       $r4
+# define v0       $r4
+# define a1       $r5
+# define v1       $r5
+# define a2       $r6
+# define a3       $r7
+# define a4       $r8
+# define a5       $r9
+# define a6       $r10
+# define a7       $r11
+# define t0       $r12
+# define t1       $r13
+# define t2       $r14
+# define t3       $r15
+# define t4       $r16
+# define t5       $r17
+# define t6       $r18
+# define t7       $r19
+/* # define at       $r19 */
+# define t8       $r20
+# define tp       $r21
+# define fp       $r22
+# define s0       $r23
+# define s1       $r24
+# define s2       $r25
+# define s3       $r26
+# define s4       $r27
+# define s5       $r28
+# define s6       $r29
+# define s7       $r30
+# define s8       $r31
+/* float point registers */
+# define fa0      $f0
+# define fv0      $f0
+# define fa1      $f1
+# define fv1      $f1
+# define fa2      $f2
+# define fa3      $f3
+# define fa4      $f4
+# define fa5      $f5
+# define fa6      $f6
+# define fa7      $f7
+# define ft0      $f8
+# define ft1      $f9
+# define ft2      $f10
+# define ft3      $f11
+# define ft4      $f12
+# define ft5      $f13
+# define ft6      $f14
+# define ft7      $f15
+# define ft8      $f16
+# define ft9      $f17
+# define ft10     $f18
+# define ft11     $f19
+# define ft12     $f20
+# define ft13     $f21
+# define ft14     $f22
+# define ft15     $f23
+# define fs0      $f24
+# define fs1      $f25
+# define fs2      $f26
+# define fs3      $f27
+# define fs4      $f28
+# define fs5      $f29
+# define fs6      $f30
+# define fs7      $f31
+
+
+/*
+ * How to add/sub/load/store/shift pointers
+ */
+#ifdef __loongarch64
+# define PTRLOG 3
+# define SZREG  8
+# define SZFREG 8
+# define REG_L ld.d
+# define REG_S st.d
+# define FREG_L fld.d
+# define FREG_S fst.d
+#else
+# error __loongarch_xlen must equal 32 or 64
+#endif
+
+
+
+/* 
+ * Stack alignment 
+ */
+#if _LOONGARCH_SIM == _ABILP64 
+# define ALSZ      15
+# define ALMASK    ~15
+#endif
+
+/* 
+ * Stack Frame Definitions 
+ */
+#if _LOONGARCH_SIM == _ABILP64
+# define NARGSAVE  0 /* No caller responsibilities */
+#else
+#error "unknown. ???:"
+#endif
+
+
+/*
+ * LEAF - declare leaf routine
+ */
+#define LEAF(symbol)                                          \
+        .text;                                                \
+        .globl  symbol;                                       \
+        .align  3;                                            \
+        cfi_startproc ;                                       \
+        .type  symbol,@function;                              \
+symbol:
+
+
+#endif /* _XPTC_ASM_LOONGARCH_UNIX_H */
--- /dev/null 
+++ b/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_loongarch64.S	2023-06-05 14:26:52.649298659 +0800
@@ -0,0 +1,128 @@
+/* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*- */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+/* #include <sys/regdef.h> */
+/* #include <sys/asm.h> */
+#include "xptc_asm_loongarch_unix.h"
+
+.text
+.globl  invoke_count_words
+.globl  invoke_copy_to_stack
+
+# a0, a1, a2, a3, s0, ra, gp
+#define LOCALSZ 7
+#define FRAMESZ  ((((NARGSAVE + LOCALSZ) * SZREG) + ALSZ) & ALMASK)
+
+#define RAOFF (FRAMESZ -(1 * SZREG))
+#define A0OFF (FRAMESZ -(2 * SZREG))
+#define A1OFF (FRAMESZ -(3 * SZREG))
+#define A2OFF (FRAMESZ -(4 * SZREG))
+#define A3OFF (FRAMESZ -(5 * SZREG))
+#define S0OFF (FRAMESZ -(6 * SZREG))
+#define GPOFF (FRAMESZ -(7 * SZREG))
+
+#
+# _NS_InvokeByIndex(that, methodIndex, paramCount, params)
+#                      a0       a1          a2         a3
+
+    .text;
+    .globl _NS_InvokeByIndex;
+    .align 2;
+    .type _NS_InvokeByIndex,@function;
+_NS_InvokeByIndex:
+    addi.d    t0, zero, FRAMESZ
+    sub.d     sp, sp, t0
+
+    st.d      ra, sp, RAOFF
+    st.d      a0, sp, A0OFF
+    st.d      a1, sp, A1OFF
+    st.d      a2, sp, A2OFF
+    st.d      a3, sp, A3OFF
+    st.d      s0, sp, S0OFF
+
+    # invoke_count_words(paramCount, params)
+    addi.d    a0, a2, 0
+    addi.d    a1, a3, 0
+    bl        invoke_count_words
+
+    # invoke_copy_to_stack(uint32_t* d, uint32_t paramCount,
+    #                      nsXPTCVariant* s, uint32_t *reg)
+
+    # save sp before we copy the params to the stack
+    addi.d    t0, sp, 0
+
+    # assume full size of 16 bytes per param to be safe
+    slli.d    v0, v0, 4     # 16 bytes * num params
+    sub.d     sp, sp, v0    # make room
+    addi.d    a0, sp, 0     # a0 - param stack address
+
+    ld.d      a1, t0, A2OFF  # a1 - paramCount
+    ld.d      a2, t0, A3OFF  # a2 - params
+
+    # create temporary stack space to write int and fp regs
+    addi.d    t1, zero, 128
+    sub.d     sp, sp, t1      # 128 = 16 regs of 8 bytes
+    addi.d    a3, sp, 0
+
+    # save the old sp and save the arg stack
+    addi.d    t1, zero, 16
+    sub.d     sp, sp, t1
+    st.d      t0, sp, 0
+    st.d      a0, sp, 8
+
+    # copy the param into the stack areas
+    bl        invoke_copy_to_stack
+
+    ld.d      t3, sp, 8    # get previous a0
+    ld.d      s0, sp, 0     # get orig sp back and save away our stack pointer
+
+    ld.d      a0, s0, A0OFF  # a0 - that
+    ld.d      a1, s0, A1OFF  # a1 - methodIndex
+
+    # t1 = methodIndex * pow(2, PTRLOG)
+    # (use shift instead of mult)
+    slli.d    t1, a1, PTRLOG
+
+    # calculate the function we need to jump to
+    ld.d      t7, a0, 0
+    add.d     t7, t7, t1
+    ld.d      t7, t7, 0
+
+    # get register save area from invoke_copy_to_stack
+    addi.d    t1, zero, 128
+    sub.d     t1, t3, t1
+
+    # a1..a7 and fa0..fa7 should now be set to what
+    # invoke_copy_to_stack told us. skip a0
+    # because that's the "this" pointer
+
+    ld.d      a1, t1, 0
+    ld.d      a2, t1, 8
+    ld.d      a3, t1, 16
+    ld.d      a4, t1, 24
+    ld.d      a5, t1, 32
+    ld.d      a6, t1, 40
+    ld.d      a7, t1, 48
+
+    fld.d     fa0, t1, 56
+    fld.d     fa1, t1, 64
+    fld.d     fa2, t1, 72
+    fld.d     fa3, t1, 80
+    fld.d     fa4, t1, 88
+    fld.d     fa5, t1, 96
+    fld.d     fa6, t1, 104
+    fld.d     fa7, t1, 112
+
+    # create the stack pointer for the function
+    addi.d    sp, t3, 0
+
+    jirl      ra, t7, 0
+
+    # restore stack pointer.
+    addi.d    sp, s0, 0
+
+    ld.d      ra, sp, RAOFF
+    ld.d      s0, sp, S0OFF
+    addi.d    sp, sp, FRAMESZ
+    jirl      zero, ra, 0
--- /dev/null
+++ b/xpcom/reflect/xptcall/md/unix/xptcinvoke_loongarch64.cpp	2023-06-05 14:25:48.449902552 +0800
@@ -0,0 +1,148 @@
+/* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*- */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+/* Platform specific code to invoke XPCOM methods on native objects */
+
+#include "xptcprivate.h"
+
+#if (_LOONGARCH_SIM != _ABILP64)
+#error "This code is for loongarch lp64 only"
+#endif
+
+extern "C" uint32_t
+invoke_count_words(uint32_t paramCount, nsXPTCVariant* s)
+{
+    return paramCount;
+}
+
+extern "C" void
+invoke_copy_to_stack(uint64_t* d, uint32_t paramCount,
+                     nsXPTCVariant* s, uint64_t *regs)
+{
+#define N_ARG_GPRS       7       /* 8 regs minus 1 for "this" ptr */
+#define N_ARG_FPRS       8
+
+    int fcount = 0;
+    int icount = 0;
+
+    for (uint32_t i = 0; i < paramCount; i++, s++)
+    {
+        if (s->IsIndirect()) {
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = (uint64_t) &s->val;
+            else
+                *d++ = (uint64_t) &s->val;
+            continue;
+        }
+        switch (s->type) {
+        //
+        // signed types first
+        //
+        case nsXPTType::T_I8:
+            if (icount < N_ARG_GPRS)
+                ((int64_t*)regs)[icount++] = s->val.i8;
+            else
+                *d++ = s->val.i8;
+            break;
+        case nsXPTType::T_I16:
+            if (icount < N_ARG_GPRS)
+                ((int64_t*)regs)[icount++] = s->val.i16;
+            else
+                *d++ = s->val.i16;
+            break;
+        case nsXPTType::T_I32:
+            if (icount < N_ARG_GPRS)
+                ((int64_t*)regs)[icount++] = s->val.i32;
+            else
+                *d++ = s->val.i32;
+            break;
+        case nsXPTType::T_I64:
+            if (icount < N_ARG_GPRS)
+                ((int64_t*)regs)[icount++] = s->val.i64;
+            else
+                *d++ = s->val.i64;
+            break;
+        //
+        // unsigned types next
+        //
+        case nsXPTType::T_U8:
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = s->val.u8;
+            else
+                *d++ = s->val.u8;
+            break;
+        case nsXPTType::T_U16:
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = s->val.u16;
+            else
+                *d++ = s->val.u16;
+            break;
+        case nsXPTType::T_U32:
+            if (icount < N_ARG_GPRS)
+		// 32-bit values need to be sign-extended
+		// in register, so use the signed value.
+                regs[icount++] = s->val.i32;
+            else
+                *d++ = s->val.u32;
+            break;
+        case nsXPTType::T_U64:
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = s->val.u64;
+            else
+                *d++ = s->val.u64;
+            break;
+        case nsXPTType::T_FLOAT:
+            // the float data formate must not be converted!
+            // Just only copy without conversion.
+            if (fcount < N_ARG_FPRS)
+                *(float*)&regs[(fcount++) + N_ARG_GPRS] = s->val.f;
+            else
+                *(float*)d++ = s->val.f;
+            break;
+        case nsXPTType::T_DOUBLE:
+            if (fcount < N_ARG_FPRS)
+                *(double*)&regs[(fcount++) + N_ARG_GPRS] = s->val.d;
+            else
+                *(double*)d++ = s->val.d;
+            break;
+        case nsXPTType::T_BOOL:
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = s->val.b;
+            else
+                *d++ = s->val.b;
+            break;
+        case nsXPTType::T_CHAR:
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = s->val.c;
+            else
+                *d++ = s->val.c;
+            break;
+        case nsXPTType::T_WCHAR:
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = s->val.wc;
+            else
+                *d++ = s->val.wc;
+            break;
+        default:
+            // all the others are plain pointer types
+            if (icount < N_ARG_GPRS)
+                regs[icount++] = (uint64_t)s->val.p;
+            else
+               *d++ = (uint64_t)s->val.p;
+            break;
+        }
+    }
+}
+
+extern "C" nsresult _NS_InvokeByIndex(nsISupports* that, uint32_t methodIndex,
+                                        uint32_t paramCount,
+                                        nsXPTCVariant* params);
+
+EXPORT_XPCOM_API(nsresult)
+NS_InvokeByIndex(nsISupports* that, uint32_t methodIndex,
+                   uint32_t paramCount, nsXPTCVariant* params)
+{
+    return _NS_InvokeByIndex(that, methodIndex, paramCount, params);
+}
--- /dev/null
+++ xpcom/reflect/xptcall/md/unix/xptcstubs_asm_loongarch64.S	2023-06-05 14:32:34.000000000 +0800
@@ -0,0 +1,113 @@
+/* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*- */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+/* #include <sys/regdef.h> */
+/* #include <sys/asm.h> */
+#include "xptc_asm_loongarch_unix.h"
+
+#define LOCALSZ 16
+#define FRAMESZ ((((NARGSAVE + LOCALSZ) * SZREG) + ALSZ) & ALMASK)
+
+#define A1OFF (FRAMESZ - (8 * SZREG))
+#define A2OFF (FRAMESZ - (7 * SZREG))
+#define A3OFF (FRAMESZ - (6 * SZREG))
+#define A4OFF (FRAMESZ - (5 * SZREG))
+#define A5OFF (FRAMESZ - (4 * SZREG))
+#define A6OFF (FRAMESZ - (3 * SZREG))
+#define A7OFF (FRAMESZ - (2 * SZREG))
+#define RAOFF (FRAMESZ - (1 * SZREG))
+
+#define FA0OFF (FRAMESZ - (16 * SZREG))
+#define FA1OFF (FRAMESZ - (15 * SZREG))
+#define FA2OFF (FRAMESZ - (14 * SZREG))
+#define FA3OFF (FRAMESZ - (13 * SZREG))
+#define FA4OFF (FRAMESZ - (12 * SZREG))
+#define FA5OFF (FRAMESZ - (11 * SZREG))
+#define FA6OFF (FRAMESZ - (10 * SZREG))
+#define FA7OFF (FRAMESZ - (9 * SZREG))
+
+#define SENTINEL_ENTRY(n)         /* defined in cpp file, not here */
+
+#define STUB_ENTRY(x)                                        \
+    .if x < 10;                                              \
+    .globl    _ZN14nsXPTCStubBase5Stub ##x ##Ev;             \
+    .type     _ZN14nsXPTCStubBase5Stub ##x ##Ev,@function;   \
+_ZN14nsXPTCStubBase5Stub ##x ##Ev:;                          \
+    addi.d    t0, zero, FRAMESZ;                             \
+    sub.d     sp, sp, t0;                                    \
+    addi.d    t0, zero, x;                                   \
+    b         sharedstub;                                   \
+    .elseif x < 100;                                         \
+    .globl    _ZN14nsXPTCStubBase6Stub ##x ##Ev;             \
+    .type     _ZN14nsXPTCStubBase6Stub ##x ##Ev,@function;   \
+_ZN14nsXPTCStubBase6Stub ##x ##Ev:;                          \
+    addi.d    t0, zero, FRAMESZ;                             \
+    sub.d     sp, sp, t0;                                    \
+    addi.d    t0, zero, x;                                   \
+    b         sharedstub;                                   \
+    .elseif x < 1000;                                        \
+    .globl    _ZN14nsXPTCStubBase7Stub ##x ##Ev;             \
+    .type     _ZN14nsXPTCStubBase7Stub ##x ##Ev,@function;   \
+_ZN14nsXPTCStubBase7Stub ##x ##Ev:;                          \
+    addi.d    t0, zero, FRAMESZ;                             \
+    sub.d     sp, sp, t0;                                    \
+    addi.d    t0, zero, x;                                   \
+    b         sharedstub;                                   \
+    .else;                                                   \
+    .err;                                                    \
+    .endif
+
+#
+# open a dummy frame for the function entries
+#
+    .text
+    .align   2
+    .type    dummy,@function
+dummy:
+#    .mask    0x90000FF0, RAOFF-FRAMESZ
+#    .fmask   0x000FF000, F19OFF-FRAMESZ
+
+#include "xptcstubsdef.inc"
+
+sharedstub:
+    st.d     a1, sp, A1OFF
+    st.d     a2, sp, A2OFF
+    st.d     a3, sp, A3OFF
+    st.d     a4, sp, A4OFF
+    st.d     a5, sp, A5OFF
+    st.d     a6, sp, A6OFF
+    st.d     a7, sp, A7OFF
+    st.d     ra, sp, RAOFF
+
+    fst.d    fa0, sp, FA0OFF
+    fst.d    fa1, sp, FA1OFF
+    fst.d    fa2, sp, FA2OFF
+    fst.d    fa3, sp, FA3OFF
+    fst.d    fa4, sp, FA4OFF
+    fst.d    fa5, sp, FA5OFF
+    fst.d    fa6, sp, FA6OFF
+    fst.d    fa7, sp, FA7OFF
+
+    # t0 is methodIndex
+    add.d    a1, t0, zero
+
+    # a2 is stack address where extra function params
+    # are stored that do not fit in registers
+    addi.d   a2, sp, FRAMESZ
+
+    # a3 is stack address of a1..a7
+    addi.d   a3, sp, A1OFF
+
+    # a4 is stack address of fa0..fa7
+    addi.d   a4, sp, FA0OFF
+
+    # PrepareAndDispatch(that, methodIndex, args, gprArgs, fpArgs)
+    #                     a0       a1        a2     a3       a4
+    #
+    bl       PrepareAndDispatch
+
+    ld.d     ra, sp, RAOFF
+
+    addi.d   sp, sp, FRAMESZ
+    jirl     zero, ra, 0
\ 文件尾没有换行符
--- /dev/null
+++ xpcom/reflect/xptcall/md/unix/xptcstubs_loongarch64.cpp	2023-06-05 14:32:53.000000000 +0800
@@ -0,0 +1,196 @@
+/* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*- */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+#include "xptcprivate.h"
+
+#if (_LOONGARCH_SIM != _ABILP64)
+#error "This code is for loongarch lp64 only"
+#endif
+
+/*
+ * This is for loongarch lp64 ABI
+ *
+ * When we're called, the "gp" registers are stored in gprData and
+ * the "fp" registers are stored in fprData.  There are 8 regs
+ * available which correspond to the first 7 parameters of the
+ * function and the "this" pointer.  If there are additional parms,
+ * they are stored on the stack at address "args".
+ *
+ */
+extern "C" nsresult ATTRIBUTE_USED
+PrepareAndDispatch(nsXPTCStubBase* self, uint32_t methodIndex, uint64_t* args,
+                   uint64_t *gprData, double *fprData)
+{
+#define PARAM_BUFFER_COUNT        16
+#define PARAM_GPR_COUNT            7
+#define PARAM_FPR_COUNT            8
+
+    nsXPTCMiniVariant paramBuffer[PARAM_BUFFER_COUNT];
+    nsXPTCMiniVariant* dispatchParams = nullptr;
+    const nsXPTMethodInfo* info;
+    uint8_t paramCount;
+    uint8_t i;
+
+    NS_ASSERTION(self,"no self");
+
+    self->mEntry->GetMethodInfo(uint16_t(methodIndex), &info);
+    NS_ASSERTION(info,"no method info");
+
+    paramCount = info->GetParamCount();
+
+    // setup variant array pointer
+    if(paramCount > PARAM_BUFFER_COUNT)
+        dispatchParams = new nsXPTCMiniVariant[paramCount];
+    else
+        dispatchParams = paramBuffer;
+    NS_ASSERTION(dispatchParams,"no place for params");
+
+    const uint8_t indexOfJSContext = info->IndexOfJSContext();
+
+    uint64_t* ap = args;
+    uint32_t iCount = 0;
+    uint32_t fCount = 0;
+    for(i = 0; i < paramCount; i++)
+    {
+        const nsXPTParamInfo& param = info->GetParam(i);
+        const nsXPTType& type = param.GetType();
+        nsXPTCMiniVariant* dp = &dispatchParams[i];
+
+        if (i == indexOfJSContext) {
+            if (iCount < PARAM_GPR_COUNT)
+                iCount++;
+            else
+                ap++;
+        }
+
+        if(param.IsOut() || !type.IsArithmetic())
+        {
+            if (iCount < PARAM_GPR_COUNT)
+                dp->val.p = (void*)gprData[iCount++];
+            else
+                dp->val.p = (void*)*ap++;
+            continue;
+        }
+        // else
+        switch(type)
+        {
+        case nsXPTType::T_I8:
+            if (iCount < PARAM_GPR_COUNT)
+                dp->val.i8  = (int8_t)gprData[iCount++];
+            else
+                dp->val.i8  = (int8_t)*ap++;
+            break;
+
+        case nsXPTType::T_I16:
+             if (iCount < PARAM_GPR_COUNT)
+                 dp->val.i16  = (int16_t)gprData[iCount++];
+             else
+                 dp->val.i16  = (int16_t)*ap++;
+             break;
+
+        case nsXPTType::T_I32:
+             if (iCount < PARAM_GPR_COUNT)
+                 dp->val.i32  = (int32_t)gprData[iCount++];
+             else
+                 dp->val.i32  = (int32_t)*ap++;
+             break;
+
+        case nsXPTType::T_I64:
+             if (iCount < PARAM_GPR_COUNT)
+                 dp->val.i64  = (int64_t)gprData[iCount++];
+             else
+                 dp->val.i64  = (int64_t)*ap++;
+             break;
+
+        case nsXPTType::T_U8:
+             if (iCount < PARAM_GPR_COUNT)
+                 dp->val.u8  = (uint8_t)gprData[iCount++];
+             else
+                 dp->val.u8  = (uint8_t)*ap++;
+             break;
+
+        case nsXPTType::T_U16:
+             if (iCount < PARAM_GPR_COUNT)
+                 dp->val.u16  = (uint16_t)gprData[iCount++];
+             else
+                  dp->val.u16  = (uint16_t)*ap++;
+             break;
+
+        case nsXPTType::T_U32:
+             if (iCount < PARAM_GPR_COUNT)
+                 dp->val.u32  = (uint32_t)gprData[iCount++];
+             else
+                 dp->val.u32  = (uint32_t)*ap++;
+             break;
+
+        case nsXPTType::T_U64:
+             if (iCount < PARAM_GPR_COUNT)
+                 dp->val.u64  = (uint64_t)gprData[iCount++];
+             else
+                 dp->val.u64  = (uint64_t)*ap++;
+             break;
+
+        case nsXPTType::T_FLOAT:
+              // the float data formate must not be converted!
+              // Just only copy without conversion.
+              if (iCount < PARAM_FPR_COUNT)
+                  dp->val.f  = *(float*)&fprData[fCount++];
+              else
+                  dp->val.f  = *((float*)ap++);
+              break;
+
+        case nsXPTType::T_DOUBLE:
+               if (iCount < PARAM_FPR_COUNT)
+                   dp->val.d  = (double)fprData[fCount++];
+               else
+                   dp->val.d  = *((double*)ap++);
+               break;
+
+        case nsXPTType::T_BOOL:
+            if (iCount < PARAM_GPR_COUNT)
+                dp->val.b  = (bool)gprData[iCount++];
+            else
+                dp->val.b  = (bool)*ap++;
+            break;
+
+        case nsXPTType::T_CHAR:
+            if (iCount < PARAM_GPR_COUNT)
+                dp->val.c  = (char)gprData[iCount++];
+            else
+                dp->val.c  = (char)*ap++;
+            break;
+
+        case nsXPTType::T_WCHAR:
+            if (iCount < PARAM_GPR_COUNT)
+                dp->val.wc  = (wchar_t)gprData[iCount++];
+            else
+                dp->val.wc  = (wchar_t)*ap++;
+            break;
+
+        default:
+            NS_ASSERTION(0, "bad type");
+            break;
+        }
+    }
+
+    nsresult result = self->mOuter->CallMethod((uint16_t)methodIndex, info,
+                                               dispatchParams);
+
+    if(dispatchParams != paramBuffer)
+        delete [] dispatchParams;
+
+    return result;
+}
+
+#define STUB_ENTRY(n)        /* defined in the assembly file */
+
+#define SENTINEL_ENTRY(n)                              \
+nsresult nsXPTCStubBase::Sentinel##n()                 \
+{                                                      \
+    NS_ASSERTION(0,"nsXPTCStubBase::Sentinel called"); \
+    return NS_ERROR_NOT_IMPLEMENTED;                   \
+}
+
+#include "xptcstubsdef.inc"
```
```sh
patch -p1 -d thunderbird-114.0 < xpcom.patch
```

编译
--
```sh
unset UNZIP  
unset ZIPINFO  #这俩是loongnix特有的
./mach configure
./mach build --priority more
```

打包(非deb)
--
  * 将会制作一个含有完整TB的压缩包
  * `./mach package`
  * 生成的文件将保存在 `obj-loongarch64-unknown-linux-gnu/dist/thunderbird-114.0.en-US.linux-loongarch64.tar.bz2`中



